openapi: 3.0.3
info:
  title: WaterBall SA Backend API
  description: |
    Backend API for WaterBall SA Platform

    This API provides endpoints for the WaterBall SA learning platform, including health checks,
    journey management, and user interactions.
  version: 1.0.0
  contact:
    name: API Support
    email: support@waterballsa.tw

servers:
  - url: http://localhost:8080
    description: Development server
  - url: https://api.waterballsa.tw
    description: Production server

tags:
  - name: Health Check
    description: API health monitoring endpoints
  - name: Auth
    description: User authentication and authorization endpoints
  - name: Journeys
    description: Learning journey management endpoints
  - name: Missions
    description: Learning mission (video/article/questionnaire) management endpoints
  - name: Progress
    description: User mission progress tracking endpoints
  - name: Users
    description: User profile and information endpoints
  - name: Orders
    description: Course purchase order management endpoints
  - name: User Journeys
    description: User purchased journey access management endpoints

paths:
  /healthz:
    $ref: './openapi/paths/health.yaml'

  /auth/register:
    $ref: './openapi/paths/auth.yaml#/register'

  /auth/login:
    $ref: './openapi/paths/auth.yaml#/login'

  /auth/logout:
    $ref: './openapi/paths/auth.yaml#/logout'

  /journeys:
    $ref: './openapi/paths/journeys.yaml#/list'

  /journeys/{journeyId}:
    $ref: './openapi/paths/journeys.yaml#/detail'

  /journeys/{journeyId}/missions/{missionId}:
    $ref: './openapi/paths/missions.yaml#/detail'

  /users/{userId}/missions/{missionId}/progress:
    $ref: './openapi/paths/progress.yaml#/detail'

  /users/{userId}/missions/{missionId}/progress/deliver:
    $ref: './openapi/paths/progress.yaml#/deliver'

  /users/me:
    $ref: './openapi/paths/users.yaml#/me'

  /orders:
    $ref: './openapi/paths/orders.yaml#/create'

  /orders/{orderId}:
    $ref: './openapi/paths/orders.yaml#/detail'

  /orders/{orderId}/pay:
    $ref: './openapi/paths/orders.yaml#/pay'

  /users/{userId}/orders:
    $ref: './openapi/paths/users.yaml#/orders'

  /users/{userId}/journeys:
    $ref: './openapi/paths/users.yaml#/journeys'

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: |
        JWT access token obtained from login endpoint.

        **Usage:**
        Include in Authorization header: `Authorization: Bearer <token>`

        **Token Contents:**
        - user_id: User identifier
        - username: Username
        - iat: Issued at timestamp
        - exp: Expiration timestamp (1 day from iat)

        **Security:**
        - Tokens expire in 1 day
        - Always use HTTPS in production

  schemas:
    # Common schemas
    HealthResponse:
      $ref: './openapi/schemas/common.yaml#/HealthResponse'
    ErrorResponse:
      $ref: './openapi/schemas/common.yaml#/ErrorResponse'

    # Auth schemas
    RegisterRequest:
      $ref: './openapi/schemas/auth.yaml#/RegisterRequest'
    RegisterResponse:
      $ref: './openapi/schemas/auth.yaml#/RegisterResponse'
    LoginRequest:
      $ref: './openapi/schemas/auth.yaml#/LoginRequest'
    LoginResponse:
      $ref: './openapi/schemas/auth.yaml#/LoginResponse'
    UserInfo:
      $ref: './openapi/schemas/auth.yaml#/UserInfo'
    LogoutResponse:
      $ref: './openapi/schemas/auth.yaml#/LogoutResponse'

    # Journey schemas
    JourneyListItem:
      $ref: './openapi/schemas/journeys.yaml#/JourneyListItem'
    JourneyDetail:
      $ref: './openapi/schemas/journeys.yaml#/JourneyDetail'
    Chapter:
      $ref: './openapi/schemas/journeys.yaml#/Chapter'
    MissionSummary:
      $ref: './openapi/schemas/journeys.yaml#/MissionSummary'

    # Mission schemas
    MissionDetail:
      $ref: './openapi/schemas/missions.yaml#/MissionDetail'
    MissionReward:
      $ref: './openapi/schemas/missions.yaml#/MissionReward'
    MissionContent:
      $ref: './openapi/schemas/missions.yaml#/MissionContent'
    UpdateProgressRequest:
      $ref: './openapi/schemas/missions.yaml#/UpdateProgressRequest'
    ProgressUpdateResponse:
      $ref: './openapi/schemas/missions.yaml#/ProgressUpdateResponse'
    DeliverResponse:
      $ref: './openapi/schemas/missions.yaml#/DeliverResponse'
    UserMissionProgress:
      $ref: './openapi/schemas/missions.yaml#/UserMissionProgress'

    # User schemas
    UserProfile:
      $ref: './openapi/schemas/users.yaml#/UserProfile'

    # Order schemas
    CreateOrderRequest:
      $ref: './openapi/schemas/orders.yaml#/CreateOrderRequest'
    OrderResponse:
      $ref: './openapi/schemas/orders.yaml#/OrderResponse'
    OrderItem:
      $ref: './openapi/schemas/orders.yaml#/OrderItem'
    PayOrderResponse:
      $ref: './openapi/schemas/orders.yaml#/PayOrderResponse'
    OrderListResponse:
      $ref: './openapi/schemas/orders.yaml#/OrderListResponse'
    OrderSummary:
      $ref: './openapi/schemas/orders.yaml#/OrderSummary'
    OrderItemSummary:
      $ref: './openapi/schemas/orders.yaml#/OrderItemSummary'
    Pagination:
      $ref: './openapi/schemas/orders.yaml#/Pagination'

    # User Journey schemas
    UserJourneyListResponse:
      $ref: './openapi/schemas/users.yaml#/UserJourneyListResponse'
    UserJourneyItem:
      $ref: './openapi/schemas/users.yaml#/UserJourneyItem'

    # Journey purchase status schema
    UserStatus:
      $ref: './openapi/schemas/journeys.yaml#/UserStatus'
